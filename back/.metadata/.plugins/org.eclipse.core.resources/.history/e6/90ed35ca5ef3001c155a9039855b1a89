package com.baemin.aop;

import java.util.Arrays;

import org.aspectj.lang.ProceedingJoinPoint;
import org.aspectj.lang.annotation.Around;
import org.aspectj.lang.annotation.Aspect;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Component;

import com.baemin.common.GuestId;
import com.baemin.dto.User;
import com.baemin.login.LoginDetails;

@Aspect
@Component
public class AOP {

	@Around("@annotation(com.baemin.aop.MemberCheck)")
	public Object memberCheck(ProceedingJoinPoint j) throws Throwable   {
		
		Object sessionUser = SecurityContextHolder.getContext().getAuthentication().getPrincipal();
		
		Object userId = null;
		boolean member = false;
		
		// 세션에 로그인 정보가 있으면 (로그인 상태)
		// userId, member = true 
		if(sessionUser instanceof LoginDetails) {
			LoginDetails user = (LoginDetails) sessionUser;
			userId = user.getUser().getUserId();
			member = true;
		} else {
		// 로그인 상태 아니면 userId = guestId, memeber = false
			userId = GuestId.getId();
			member = false;
		}
		
		System.out.println(Arrays.toString(j.getArgs()));
		
		Object resultObj = j.proceed(new Object[] {userId, member});
		
		return resultObj;
	}
	
	
	@Around("@annotation(com.baemin.aop.MemberCheck)")
	public Object test(ProceedingJoinPoint j) throws Throwable   {
		
		System.out.println("service");
		
		return null;
	}

}
